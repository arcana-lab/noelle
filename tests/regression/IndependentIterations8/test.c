#include <math.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// Precision to use for calculations
#define fptype float

typedef struct OptionData_ {
  fptype s;        // spot price
  fptype strike;   // strike price
  fptype r;        // risk-free interest rate
  fptype divq;     // dividend rate
  fptype v;        // volatility
  fptype t;        // time to maturity or option expiration in years
                   //     (1yr = 1.0, 6mos = 0.5, 3mos = 0.25, ..., etc)
  char OptionType; // Option type.  "P"=PUT, "C"=CALL
  fptype divs;     // dividend vals (not used in this test)
  fptype DGrefval; // DerivaGem Reference Value
} OptionData;

OptionData *data;
fptype *prices;
int numOptions;

int *otype;
fptype *sptprice;
fptype *strike;
fptype *rate;
fptype *volatility;
fptype *otime;
int numError = 0;

int bs_thread(void) {
  int i, j;
  fptype price;
  fptype priceDelta;
  int start = 0;
  int end = start + numOptions;

  for (i = start; i < end; i++) {
    prices[i] = i;
  }

  return 0;
}

int main(int argc, char **argv) {
  FILE *file;
  int i;
  int loopnum;
  fptype *buffer;
  int *buffer2;
  int rv;

  // Read input data
  numOptions = atoll(argv[1]);

  // alloc spaces for the option data
  data = (OptionData *)malloc(numOptions * sizeof(OptionData));
  prices = (fptype *)malloc(numOptions * sizeof(fptype));
  printf("Num of Options: %d\n", numOptions);

#define PAD 256
#define LINESIZE 64

  buffer = (fptype *)malloc(5 * numOptions * sizeof(fptype) + PAD);
  sptprice = (fptype *)(((unsigned long long)buffer + PAD) & ~(LINESIZE - 1));
  strike = sptprice + numOptions;
  rate = strike + numOptions;
  volatility = rate + numOptions;
  otime = volatility + numOptions;

  buffer2 = (int *)malloc(numOptions * sizeof(fptype) + PAD);
  otype = (int *)(((unsigned long long)buffer2 + PAD) & ~(LINESIZE - 1));

  for (i = 0; i < numOptions; i++) {
    otype[i] = (data[i].OptionType == 'P') ? 1 : 0;
    sptprice[i] = data[i].s;
    strike[i] = data[i].strike;
    rate[i] = data[i].r;
    volatility[i] = data[i].v;
    otime[i] = data[i].t;
  }

  bs_thread();

  return 0;
}
